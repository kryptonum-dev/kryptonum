---
import type { ComponentProps } from 'astro/types'
import SimpleCtaSection, { SimpleCtaSection_Query } from '@repo/shared/components/SimpleCtaSection.astro'
import Faq, { Faq_Query } from '@repo/shared/components/Faq.astro'
import TagsSection, { TagsSection_Query } from '@repo/shared/components/TagsSection.astro'
import MarqueePillSection, { MarqueePillSection_Query } from '@repo/shared/components/MarqueePillSection.astro'
import HeaderGridIcons, { HeaderGridIcons_Query } from '@repo/shared/components/HeaderGridIcons.astro'
import SimpleHeaderWithImage, { SimpleHeaderWithImage_Query } from '@repo/shared/components/SimpleHeaderWithImage.astro'
import SplitScreenCtaSection, { SplitScreenCtaSection_Query } from '@repo/shared/components/SplitScreenCtaSection.astro'
import OverlappingCircles, { OverlappingCircles_Query } from '@repo/shared/components/OverlappingCircles.astro'
import PillCtaSection, { PillCtaSection_Query } from '@repo/shared/components/PillCtaSection.astro'
import StackImagesWithCtaAndAvatars, {
  StackImagesWithCtaAndAvatars_Query,
} from '@repo/shared/components/StackImagesWithCtaAndAvatars.astro'
import ImageAndNumberedList, { ImageAndNumberedList_Query } from '@repo/shared/components/ImageAndNumberedList.astro'
import SkillsAndLinks, { SkillsAndLinks_Query } from '@repo/shared/components/SkillsAndLinks.astro'
import ContactInfo, { ContactInfo_Query } from '@repo/shared/components/ContactInfo.astro'
import SimpleTextSection, { SimpleTextSection_Query } from '@repo/shared/components/SimpleTextSection.astro'
import AvailabilityStatus, { AvailabilityStatus_Query } from '@repo/shared/components/AvailabilityStatus.astro'
import GroupedElements, { GroupedElements_Query } from '@repo/shared/components/GroupedElements.astro'
import SimpleCtaColumnWithMedia, {
  SimpleCtaColumnWithMedia_Query,
} from '@repo/shared/components/SimpleCtaColumnWithMedia.astro'
import TeamSpotlight, { TeamSpotlight_Query } from '@repo/shared/components/TeamSpotlight.astro'
import PerformanceHighlights, { PerformanceHighlights_Query } from '@repo/shared/components/PerformanceHighlights.astro'
import RichListAndCtaBox, { RichListAndCtaBox_Query } from '@repo/shared/components/RichListAndCtaBox.astro'
import NarrowHeaderAndMedia, { NarrowHeaderAndMedia_Query } from '@repo/shared/components/NarrowHeaderAndMedia.astro'
import ProcessItemsGraph, { ProcessItemsGraph_Query } from '@repo/shared/components/ProcessItemsGraph.astro'
import Reviews, { Reviews_Query } from '@repo/shared/components/Reviews.astro'
import SingleReview, { SingleReview_Query } from '@repo/shared/components/SingleReview.astro'
import LatestBlogPosts, { LatestBlogPosts_Query } from '@repo/shared/components/LatestBlogPosts.astro'
import TrustedCompanies, { TrustedCompanies_Query } from '@repo/shared/components/TrustedCompanies.astro'
import ContactForm, { ContactForm_Query } from '@repo/shared/components/ContactForm/ContactForm.astro'
import PersonIntroduction, { PersonIntroduction_Query } from '@repo/shared/components/PersonIntroduction.astro'
import PersonEmojisIntroduction, {
  PersonEmojisIntroduction_Query,
} from '@repo/shared/components/PersonEmojisIntroduction.astro'
import StatsHighlight, { StatsHighlight_Query } from '@repo/shared/components/StatsHighlight.astro'
import TeamIntroduction, { TeamIntroduction_Query } from '@repo/shared/components/TeamIntroduction.astro'
import CenteredMediaTextSection, {
  CenteredMediaTextSection_Query,
} from '@repo/shared/components/CenteredMediaTextSection.astro'
import DetailedInfoAndStats, { DetailedInfoAndStats_Query } from '@repo/shared/components/DetailedInfoAndStats.astro'
import CaseStudyShowcase, { CaseStudyShowcase_Query } from '@repo/shared/components/CaseStudyShowcase.astro'
import MediaShowcase, { MediaShowcase_Query } from '@repo/shared/components/MediaShowcase.astro'
import MediaIrregularShowcase, {
  MediaIrregularShowcase_Query,
} from '@repo/shared/components/MediaIrregularShowcase.astro'
import CompareTable, { CompareTable_Query } from '@repo/shared/components/CompareTable.astro'
import Timeline, { Timeline_Query } from '@repo/shared/components/Timeline.astro'
import NetworkedShowcase, { NetworkedShowcase_Query } from '@repo/shared/components/NetworkedShowcase.astro'
import Newsletter, { Newsletter_Query } from '@repo/shared/components/Newsletter/Newsletter.astro'
import ChartWithSimpleText, { ChartWithSimpleText_Query } from '@repo/shared/components/ChartWithSimpleText.astro'
import TabsText, { TabsText_Query } from '@repo/shared/components/TabsText.astro'
import DecryptTabs, { DecryptTabs_Query } from '@repo/shared/components/DecryptTabs.astro'
import TagsLine, { TagsLine_Query } from '@repo/shared/components/TagsLine.astro'
import StagesAccordion, { StagesAccordion_Query } from '@repo/shared/components/StagesAccordion.astro'
import Pricing, { Pricing_Query } from '@repo/shared/components/Pricing.astro'
import PricingRange, { PricingRange_Query } from '@repo/shared/components/PricingRange.astro'
import PricingTiles, { PricingTiles_Query } from '@repo/shared/components/PricingTiles.astro'
import ShowcaseProjectsExpand, {
  ShowcaseProjectsExpand_Query,
} from '@repo/shared/components/ShowcaseProjectsExpand.astro'
import ExpertProfiles, { ExpertProfiles_Query } from '@repo/shared/components/ExpertProfiles.astro'
import FullWidthImage, { FullWidthImage_Query } from '@repo/shared/components/FullWidthImage.astro'
import GridIconsList, { GridIconsList_Query } from '@repo/shared/components/GridIconsList.astro'
import ProductHighlight, { ProductHighlight_Query } from '@repo/shared/components/ProductHighlight.astro'
import FeaturedProducts, { FeaturedProducts_Query } from '@repo/shared/components/FeaturedProducts.astro'
import IrregularBlocksWithStats, {
  IrregularBlocksWithStats_Query,
} from '@repo/shared/components/IrregularBlocksWithStats.astro'
import ImageListAndMarquee, { ImageListAndMarquee_Query } from '@repo/shared/components/ImageListAndMarquee.astro'
import SimpleGridGallery, { SimpleGridGallery_Query } from '@repo/shared/components/SimpleGridGallery.astro'
import HighlightsGrid, { HighlightsGrid_Query } from '@repo/shared/components/HighlightsGrid.astro'

const components = {
  SimpleCtaSection,
  Faq,
  TagsSection,
  MarqueePillSection,
  HeaderGridIcons,
  SimpleHeaderWithImage,
  SplitScreenCtaSection,
  OverlappingCircles,
  PillCtaSection,
  StackImagesWithCtaAndAvatars,
  ImageAndNumberedList,
  SkillsAndLinks,
  ContactInfo,
  SimpleTextSection,
  AvailabilityStatus,
  GroupedElements,
  SimpleCtaColumnWithMedia,
  TeamSpotlight,
  PerformanceHighlights,
  RichListAndCtaBox,
  NarrowHeaderAndMedia,
  ProcessItemsGraph,
  Reviews,
  SingleReview,
  LatestBlogPosts,
  TrustedCompanies,
  ContactForm,
  PersonIntroduction,
  PersonEmojisIntroduction,
  StatsHighlight,
  TeamIntroduction,
  CenteredMediaTextSection,
  DetailedInfoAndStats,
  CaseStudyShowcase,
  MediaShowcase,
  MediaIrregularShowcase,
  CompareTable,
  Timeline,
  NetworkedShowcase,
  Newsletter,
  ChartWithSimpleText,
  TabsText,
  DecryptTabs,
  TagsLine,
  StagesAccordion,
  Pricing,
  PricingRange,
  PricingTiles,
  ShowcaseProjectsExpand,
  ExpertProfiles,
  FullWidthImage,
  GridIconsList,
  ProductHighlight,
  FeaturedProducts,
  IrregularBlocksWithStats,
  ImageListAndMarquee,
  SimpleGridGallery,
  HighlightsGrid,
}

type ComponentsMap = {
  [Component in keyof typeof components]: {
    _type: Component
  } & ComponentProps<(typeof components)[Component]>
}

export type ComponentsProps = Array<ComponentsMap[keyof typeof components]>

type Props = {
  data: ComponentsProps
  hasPreviousSections?: boolean
}

const { data, hasPreviousSections = false } = Astro.props

export const Components_Query = /* groq */ `
  components[] {
    _type,
    sectionId,
    ${SimpleCtaSection_Query}
    ${Faq_Query}
    ${TagsSection_Query}
    ${MarqueePillSection_Query}
    ${HeaderGridIcons_Query(true)}
    ${SimpleHeaderWithImage_Query(true)}
    ${SplitScreenCtaSection_Query}
    ${OverlappingCircles_Query}
    ${PillCtaSection_Query}
    ${StackImagesWithCtaAndAvatars_Query}
    ${ImageAndNumberedList_Query}
    ${SkillsAndLinks_Query}
    ${ContactInfo_Query}
    ${SimpleTextSection_Query}
    ${AvailabilityStatus_Query}
    ${GroupedElements_Query}
    ${SimpleCtaColumnWithMedia_Query}
    ${TeamSpotlight_Query}
    ${PerformanceHighlights_Query}
    ${RichListAndCtaBox_Query}
    ${NarrowHeaderAndMedia_Query}
    ${ProcessItemsGraph_Query}
    ${Reviews_Query}
    ${SingleReview_Query}
    ${LatestBlogPosts_Query}
    ${TrustedCompanies_Query}
    ${ContactForm_Query}
    ${PersonIntroduction_Query}
    ${PersonEmojisIntroduction_Query}
    ${StatsHighlight_Query}
    ${TeamIntroduction_Query}
    ${CenteredMediaTextSection_Query}
    ${DetailedInfoAndStats_Query}
    ${CaseStudyShowcase_Query}
    ${MediaShowcase_Query}
    ${MediaIrregularShowcase_Query}
    ${CompareTable_Query}
    ${Timeline_Query}
    ${NetworkedShowcase_Query}
    ${Newsletter_Query}
    ${ChartWithSimpleText_Query}
    ${TabsText_Query}
    ${DecryptTabs_Query}
    ${TagsLine_Query}
    ${StagesAccordion_Query}
    ${Pricing_Query}
    ${PricingRange_Query}
    ${PricingTiles_Query}
    ${ShowcaseProjectsExpand_Query}
    ${ExpertProfiles_Query}
    ${FullWidthImage_Query}
    ${GridIconsList_Query}
    ${ProductHighlight_Query}
    ${FeaturedProducts_Query}
    ${IrregularBlocksWithStats_Query}
    ${ImageListAndMarquee_Query}
    ${SimpleGridGallery_Query}
    ${HighlightsGrid_Query}
  },
`
---

{
  data?.map((item, i) => {
    // NOTE: Using 'as any' is not ideal for type safety, but it's used here to simplify
    // the implementation and avoid creating separate typed interfaces for each component.
    const DynamicComponent = components[item._type] as any
    if (!DynamicComponent) return null
    return <DynamicComponent {...item} index={hasPreviousSections ? ++i : i} />
  })
}
